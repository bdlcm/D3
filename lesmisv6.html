<!DOCTYPE html>
<meta charset="utf-8">
<style>

*/
html {
  font-family: serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
}

.links line {
  stroke: #999;
  stroke-opacity: 0.6;
}
.nodes circle {
  stroke: #fff;
  stroke-width: 1.5px;
}

.searchcomponent {
    
   
    float:right;
}

body {
    padding-top: 20px;
  line-height: 1.8;
  height:relative;
  width: relative;

  text-align: justify;
  vertical-align: middle;
}

.formpanel {
  width: 190px;
  background-color: rgba(245, 245, 245, 0.75);
  padding: 10px;
  margin-bottom: 10px;
  pointer-events: auto;
  float: right;
  border-bottom-left-radius: 10px;
}

</style>
<body>
<svg width="960" height="600"></svg>



<div class="formpanel"> 





            <h3><span float-right id="node-heading">Node info</span>
          <small><a href="#nodepanel" data-toggle="collapse" aria-expanded="true" aria-controls="nodepanel">
          <span class='glyphicon glyphicon-resize-small pull-right'></span>
          </a></small>
        </h3>
        <ul class="list-group list-group-sm">
        <div id="nodepanel" class="panel-collapse collapse in">
          <li class="list-group-item"><span id="nodeinfo"></span></li>
        </div>
        <div id="associations" class="panel-collapse collapse in">
          <li class="list-group-item"><span id="chariteassociations"></span></li>
        </div>
      </ul>

      <br>

         <div>
            <h3>Statistics
              <small><a href="#statpanel" data-toggle="collapse" aria-expanded="true" aria-controls="statpanel">
              <span class='glyphicon glyphicon-resize-small pull-right'></span>
              </a></small>
            </h3>
            <div id="statpanel" class="panel-collapse collapse in">
              <ul class="list-group list-group-sm">
                <li class="list-group-item"><span class="badge badge-sm stats-item" id="stats-n">105 </span>Total Publications</li>
                <li class="list-group-item"><span class="badge stats-item" id="stats-m">7 </span>Grants</li>
                <li class="list-group-item"><span class="badge stats-item" id="stats-s">9 </span>Associations</li>
              </ul>
            </div>
          </div>
</div>







<script src="https://d3js.org/d3.v4.min.js"></script>
<script>



var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");
// Call zoom for svg container.

svg.call(d3.zoom().on('zoom', zoomed));
var color = d3.scaleOrdinal(d3.schemeCategory20);





var container = svg.append('g');
// Create form for search (see function below).

var search = d3.select("body").append('form').attr('onsubmit', 'return false;').attr("class", "searchcomponent");
var box = search.append('input')
	.attr('type', 'text')
	.attr('id', 'searchTerm')
	.attr('placeholder', 'Type to search...');
var button = search.append('input')
	.attr('type', 'button')
	.attr('value', 'Search')
    .on('click', function () { searchNodes(); })








// Toggle for ego networks on click (below).
var toggle = 0;


var simulation=0;
var link1 = "https://gist.githubusercontent.com/mbostock/4062045/raw/5916d145c8c048a6e3086915a6be464467391c62/miserables.json";


var gotoLink=link1;




d3.json(link1 = "https://gist.githubusercontent.com/mbostock/4062045/raw/5916d145c8c048a6e3086915a6be464467391c62/miserables.json", function(error, graph) {
	if (error) throw error;


  //depending on our needs (initial display, search for author, loading 10 more authors, json has to change dynamically)
    



    simulation = d3.forceSimulation(graph.nodes)
    .force("charge", d3.forceManyBody().strength(-1000))

    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("x", d3.forceX(width / 2).strength(1))
    .force("y", d3.forceY(height / 2).strength(1))
    .force("link", d3.forceLink(graph.links).id(function(d) {return d.id; }).distance(50).strength(0.9));


    simulation
    .nodes(graph.nodes)
    .on("tick", ticked);
     
    


    


  // Make object of all neighboring nodes.
  var linkedByIndex = {};
  graph.links.forEach(function(d) {
	  linkedByIndex[d.source + ',' + d.target] = 1;
	  linkedByIndex[d.target + ',' + d.source] = 1;
  });
  // A function to test if two nodes are neighboring.
  // function neighboring(a, b) {
	//   return linkedByIndex[a.index + ',' + b.index];
  // }

  //calculating number of links per node
    graph.links.forEach(function(link){

    if (!link.source["linkCount"]) link.source["linkCount"] = 0;
    if (!link.target["linkCount"]) link.target["linkCount"] = 0;

    link.source["linkCount"]++;
    link.target["linkCount"]++;

    });

    
    




    //forming the links and how they look

	var link = container.append("g").attr("class", "links")
    .selectAll("line")
    .data(graph.links)
    .enter()
    .append("line")
    .attr("stroke", "#aaa")
    .attr("stroke-width", function(d){
        return (d.value);
      })
       .on("mouseover", mouseover)
          .on("mouseout", mouseout);

    


      //forming the nodes and how they look ie the circle
	var node = container.append("g")
    .attr("class", "nodes")
    .selectAll("circle")
    .data(graph.nodes)
    .enter().append("circle")
    .attr("r", function(d){
        return d.linkCount ? (d.linkCount * 2) : 2;
      })



      .attr("fill", function(d) { return color(d.group); })
      .attr('class', 'node')
      // On click, toggle  network so it's focused on it
      .on('click', function(d, i) {
	      if (toggle == 0) {
		      // Ternary operator restyles links and nodes if they are adjacent.
		      d3.selectAll('.link').style('stroke-opacity', function (l) {
			      return l.target == d || l.source == d ? 1 : 0.1;
		      });
		      d3.selectAll('.node').style('opacity', function (n) {
			      return neighboring(d, n) ? 1 : 0.1;
		      });
		      d3.select(this).style('opacity', 1);
		      toggle = 1;
	      }
	      else {
		      // Restore nodes and links to normal opacity.
		      d3.selectAll('.link').style('stroke-opacity', '0.6');
		      d3.selectAll('.node').style('opacity', '1');
		      toggle = 0;
	      }
       }) 
       
      .on("mouseover", mouseover)
          .on("mouseout", mouseout)
      .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
		    .on("end", dragended));

     
        

//labels
	var text = container.append("g")
    .attr("class", "labels")
    .selectAll("text")
    .data(graph.nodes)
    .enter().append("text")
    .attr("dx", 12)
    .attr("dy", ".35em")
		.text(function(d) { return d.id })
		.style("fill", "#555")
    .style("font-family", "Arial")
    .style("font-size", 12)
    .style("text-align", "center")
    .style("pointer-events", "none")
     .on("mouseover", mouseover)
          .on("mouseout", mouseout); // to prevent mouseover/drag capture





  function ticked() {
    link
        .attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });
    node
        .attr("cx", function(d) { return d.x; })
				.attr("cy", function(d) { return d.y; });

		text
			.attr("x", function(d) { return d.x; })
        .attr("y", function(d) { return d.y; });
  }

// connected to stats
  node.on("click", function(d){
    showNodeInfo(d);
    });



function removeNodeInfo() {
    document.getElementById("nodeinfo").innerHTML = "Publications";
    document.getElementById("node-heading").innerHTML = "Person";
    document.getElementById("chariteassociations").innerHTML = "Associations";
    
}

function showNodeInfo(d) {
    //console.log(htmlTabForNode(d));
    // document.getElementById("nodeinfo").innerHTML = htmlTabForNode(d);
    document.getElementById("node-heading").innerHTML = d.id;

    document.getElementById("nodeinfo").innerHTML = d.linkCount +" " + "Publications";
    document.getElementById("chariteassociations").placeholder = "Associations";


}


function neighboring(a, b) {
      return a.index == b.index || linkedByIndex[a.index + "," + b.index];
    }

function mouseover(d) {
  d3.selectAll('.link').transition().duration(500)
        
        .style("stroke-opacity", function(o) {
        return o.source === d || o.target === d ? 0 : 0;
      });
      
      d3.selectAll('.node').transition().duration(500)
        .style("opacity", function(o) {
           return neighboring(d, o) ? 1 : 0;
        });
}


 function mouseout() {
  d3.selectAll('.link').transition().duration(500)
         .style("opacity", 1)
         .style('stroke-opacity', '1');
  d3.selectAll('.node').transition().duration(500)
         .style("opacity", 1);
 }


});













function dragstarted(d) {
    d3.event.sourceEvent.stopPropagation();
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}
function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

// set variables to dy or dx for fixed position after dragging
function dragended(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}
// Zooming function translates the size of the svg container.
function zoomed() {
	  container.attr("transform", "translate(" + d3.event.transform.x + ", " + d3.event.transform.y + ") scale(" + d3.event.transform.k + ")");
}
// Search for nodes by making all unmatched nodes temporarily transparent.
function searchNodes() {
  // var gotoLink=link1; change gotolink to access main graph then render new graph do this later 
	var term = document.getElementById('searchTerm').value;
	var selected = container.selectAll('.node').filter(function (d, i) {
		return d.id.toLowerCase().search(term.toLowerCase()) == -1;
	});
	selected.style('opacity', '0');
	var link = container.selectAll('.link');
	link.style('stroke-opacity', '0');
	d3.selectAll('.node').transition()
		.duration(5000)
		.style('opacity', '1');
    d3.selectAll('.link').transition().duration(5000).style('stroke-opacity', '1');
    d3.selectAll('text').transition().duration(5000).style('stroke-opacity', '1')
    
    
}





 



</script>
</body>